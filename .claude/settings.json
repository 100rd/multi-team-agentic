{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  },
  "teammateMode": "tmux",
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"PRE_WRITE_CHECK: file=$CLAUDE_FILE_PATH status=validating\"'"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -q \"git commit\"; then echo \"CHECKPOINT: type=git_commit action=review_required\"; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qiE \"claude|anthropic|co-authored-by\"; then echo \"BLOCKED: rule=no_ai_mentions detail=Remove all AI references from git commands\" && exit 1; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"git push\" && echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"\\b(main|master)\\b\"; then echo \"BLOCKED: rule=no_push_main detail=Use feature branch and create PR\" && exit 1; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"git merge.*(main|master)|git merge\\b\" && echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"(main|master)\"; then echo \"BLOCKED: rule=no_merge_main detail=Create a Pull Request instead\" && exit 1; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"git checkout (main|master)\"; then echo \"WARNING: rule=checkout_main detail=Do NOT commit or merge directly\"; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"terraform (apply|destroy)\"; then echo \"CHECKPOINT: type=terraform_apply action=human_approval_required severity=critical\"; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"terragrunt (apply|destroy|run-all.*apply|run-all.*destroy)\"; then echo \"CHECKPOINT: type=terragrunt_apply action=human_approval_required severity=critical\"; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qiE \"(password|secret|api_key|apikey|token|credential|private_key)[[:space:]]*=[[:space:]]*.\"; then echo \"BLOCKED: rule=secret_detected detail=Use environment variables or secret managers\" && exit 1; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"git (add|commit)\" && echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"\\.(env|pem|key|credentials|secret)\" ; then echo \"WARNING: rule=sensitive_file detail=Verify no secrets included\"; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"terraform state (rm|mv|push|replace-provider)\"; then echo \"CHECKPOINT: type=state_modification action=backup_required severity=high\"; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"terraform destroy\"; then echo \"CHECKPOINT: type=terraform_destroy action=explicit_confirmation severity=critical detail=Will DELETE infrastructure\"; fi'"
          },
          {
            "type": "command",
            "command": "bash -c 'if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE \"terraform import\"; then echo \"CHECKPOINT: type=terraform_import action=verify_resource_id severity=medium\"; fi'"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'EXT=\"${CLAUDE_FILE_PATH##*.}\"; echo \"POST_WRITE: file=$CLAUDE_FILE_PATH ext=$EXT\"; if [[ \"$EXT\" == \"tf\" ]] || [[ \"$EXT\" == \"hcl\" ]]; then echo \"ACTION_REQUIRED: run=terraform_fmt,terraform_validate\"; fi; if [[ \"$EXT\" == \"tf\" ]] && grep -qiE \"(password|secret|api_key|token|credential)[[:space:]]*=[[:space:]]*[^$]\" \"$CLAUDE_FILE_PATH\" 2>/dev/null; then echo \"WARNING: rule=hardcoded_secret detail=Use variables or secret manager\"; fi'"
          }
        ]
      },
      {
        "matcher": "MultiEdit",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"POST_EDIT: status=changes_applied\"'"
          }
        ]
      }
    ],
    "SubagentStop": [
      {
        "matcher": "qa-engineer",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=qa-engineer type=testing\"'"
          }
        ]
      },
      {
        "matcher": "product-manager",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=product-manager type=planning\"'"
          }
        ]
      },
      {
        "matcher": "infrastructure-validator",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=infrastructure-validator type=validation\"'"
          }
        ]
      },
      {
        "matcher": "devops-engineer",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=devops-engineer type=infrastructure\"'"
          }
        ]
      },
      {
        "matcher": "solution-architect",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=solution-architect type=architecture\"'"
          }
        ]
      },
      {
        "matcher": "simplifier",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=simplifier type=review\"'"
          }
        ]
      },
      {
        "matcher": "best-practices-validator",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=best-practices-validator type=validation\"'"
          }
        ]
      },
      {
        "matcher": "activity-tracker",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=activity-tracker type=memory\"'"
          }
        ]
      },
      {
        "matcher": "drift-detector",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=drift-detector type=infrastructure\"'"
          }
        ]
      },
      {
        "matcher": "terraform-engineer",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=terraform-engineer type=infrastructure\"'"
          }
        ]
      },
      {
        "matcher": "security-expert",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=security-expert type=security\"'"
          }
        ]
      },
      {
        "matcher": "terraform-migration-engineer",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=terraform-migration-engineer type=migration\"'"
          }
        ]
      },
      {
        "matcher": "senior-backend-engineer",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=senior-backend-engineer type=development\"'"
          }
        ]
      },
      {
        "matcher": "senior-frontend-engineer",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_COMPLETE: agent=senior-frontend-engineer type=development\"'"
          }
        ]
      }
    ],
    "SubagentStart": [
      {
        "matcher": ".*",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'echo \"AGENT_START: MANDATORY_PROTOCOL=(1)Read project/PROJECT_HISTORY.md (2)Query relevant history for your task (3)Track your actions to PROJECT_HISTORY.md+project_history.json BEFORE returning. You are responsible for self-tracking.\"'"
          }
        ]
      }
    ]
  }
}
